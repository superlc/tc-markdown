/**
 * @tc/md-core 默认样式
 * 
 * 使用方法：
 * import '@tc/md-core/styles.css';
 * <div class="markdown-body">...</div>
 * 
 * 定制主题：
 * :root { --md-color-primary: red; }
 * 
 * 强制暗黑/浅色：
 * <div class="markdown-body md-dark">...</div>
 */

/* ========================================
   CSS 变量定义 - 浅色模式（默认）
   ======================================== */
:root,
.md-light {
    /* 基础颜色 */
    --md-color-text: #24292f;
    --md-color-text-muted: #656d76;
    --md-color-primary: #0969da;
    --md-color-bg: #ffffff;
    --md-color-border: #d0d7de;

    /* 代码 */
    --md-color-bg-muted: rgba(175, 184, 193, 0.2);
    --md-color-bg-code-block: #f6f8fa;

    /* 表格 */
    --md-color-bg-table-header: rgba(175, 184, 193, 0.2);
    --md-color-bg-table-row: rgba(234, 238, 242, 0.5);

    /* 引用 */
    --md-color-blockquote-border: rgba(175, 184, 193, 0.4);

    /* 字体 */
    --md-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
    --md-font-family-mono: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
    --md-font-size-base: 14px;
    --md-line-height: 1.5;

    /* 圆角 */
    --md-radius: 6px;
    --md-radius-sm: 4px;

    /* 图片骨架屏 */
    --md-skeleton-bg: #e8e8e8;
    --md-skeleton-shine: #f5f5f5;
    --md-skeleton-icon: #bdbdbd;
    --md-skeleton-icon-detail: #9e9e9e;

    /* 代码高亮 - 浅色 */
    --md-hljs-bg: #f6f8fa;
    --md-hljs-text: #24292f;
    --md-hljs-keyword: #cf222e;
    --md-hljs-string: #0a3069;
    --md-hljs-comment: #6e7781;
    --md-hljs-function: #8250df;
    --md-hljs-number: #0550ae;

    /* Pending 状态 */
    --md-pending-border-color: #0969da;
}

/* ========================================
   暗黑模式 - 系统偏好
   ======================================== */
@media (prefers-color-scheme: dark) {
    :root:not(.md-light) {
        --md-color-text: #e6edf3;
        --md-color-text-muted: #8b949e;
        --md-color-primary: #4493f8;
        --md-color-bg: #0d1117;
        --md-color-border: #30363d;

        --md-color-bg-muted: rgba(110, 118, 129, 0.4);
        --md-color-bg-code-block: #161b22;

        --md-color-bg-table-header: rgba(110, 118, 129, 0.4);
        --md-color-bg-table-row: rgba(110, 118, 129, 0.1);

        --md-color-blockquote-border: rgba(110, 118, 129, 0.4);

        --md-skeleton-bg: #21262d;
        --md-skeleton-shine: #30363d;
        --md-skeleton-icon: #484f58;
        --md-skeleton-icon-detail: #6e7681;

        --md-hljs-bg: #161b22;
        --md-hljs-text: #e6edf3;
        --md-hljs-keyword: #ff7b72;
        --md-hljs-string: #a5d6ff;
        --md-hljs-comment: #8b949e;
        --md-hljs-function: #d2a8ff;
        --md-hljs-number: #79c0ff;

        --md-pending-border-color: #4493f8;
    }
}

/* ========================================
   暗黑模式 - 手动强制（优先级最高）
   ======================================== */
.md-dark {
    --md-color-text: #e6edf3;
    --md-color-text-muted: #8b949e;
    --md-color-primary: #4493f8;
    --md-color-bg: #0d1117;
    --md-color-border: #30363d;

    --md-color-bg-muted: rgba(110, 118, 129, 0.4);
    --md-color-bg-code-block: #161b22;

    --md-color-bg-table-header: rgba(110, 118, 129, 0.4);
    --md-color-bg-table-row: rgba(110, 118, 129, 0.1);

    --md-color-blockquote-border: rgba(110, 118, 129, 0.4);

    --md-skeleton-bg: #21262d;
    --md-skeleton-shine: #30363d;
    --md-skeleton-icon: #484f58;
    --md-skeleton-icon-detail: #6e7681;

    --md-hljs-bg: #161b22;
    --md-hljs-text: #e6edf3;
    --md-hljs-keyword: #ff7b72;
    --md-hljs-string: #a5d6ff;
    --md-hljs-comment: #8b949e;
    --md-hljs-function: #d2a8ff;
    --md-hljs-number: #79c0ff;

    --md-pending-border-color: #4493f8;
}

/* ========================================
   Markdown 容器
   ======================================== */
.markdown-body {
    font-family: var(--md-font-family);
    font-size: var(--md-font-size-base);
    line-height: var(--md-line-height);
    color: var(--md-color-text);
    background-color: var(--md-color-bg);
    word-wrap: break-word;
}

/* 子元素间距 */
.markdown-body>*+* {
    margin-top: 1rem;
}

/* 首个子元素无顶部 margin */
.markdown-body>*:first-child {
    margin-top: 0;
}

/* 最后子元素无底部 margin */
.markdown-body>*:last-child {
    margin-bottom: 0;
}

/* ========================================
   标题
   ======================================== */
.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
    line-height: 1.25;
    color: var(--md-color-text);
}

/* h1: 1.875rem (30px) */
.markdown-body h1 {
    font-size: 1.875rem;
}

/* h2: 1.5rem (24px) */
.markdown-body h2 {
    font-size: 1.5rem;
}

/* h3: 1.25rem (20px) */
.markdown-body h3 {
    font-size: 1.25rem;
}

/* h4: 1.125rem (18px) */
.markdown-body h4 {
    font-size: 1.125rem;
}

/* h5: 1rem (16px) */
.markdown-body h5 {
    font-size: 1rem;
}

/* h6: 0.875rem (14px) */
.markdown-body h6 {
    font-size: 0.875rem;
}

/* ========================================
   段落
   ======================================== */
.markdown-body p {
    margin-top: 0;
    margin-bottom: 0;
}

/* ========================================
   链接
   ======================================== */
.markdown-body a {
    color: var(--md-color-primary);
    text-decoration: underline;
    overflow-wrap: anywhere;
}

.markdown-body a:hover {
    opacity: 0.8;
}

/* ========================================
   粗体
   ======================================== */
.markdown-body strong {
    font-weight: 600;
}

/* ========================================
   行内代码
   ======================================== */
.markdown-body code {
    background-color: var(--md-color-bg-muted);
    border-radius: var(--md-radius-sm);
    padding: 0.125rem 0.375rem;
    font-size: 0.875rem;
    font-family: var(--md-font-family-mono);
}

/* ========================================
   代码块
   ======================================== */
.markdown-body pre {
    margin-top: 0;
    margin-bottom: 0;
    background-color: var(--md-color-bg-code-block);
    border-radius: var(--md-radius);
    padding: 1rem;
    overflow-x: auto;
}

.markdown-body pre code {
    background: transparent;
    padding: 0;
    font-size: 0.875rem;
    border-radius: 0;
    line-height: 1.45;
}

/* ========================================
   引用块
   ======================================== */
.markdown-body blockquote {
    margin: 1rem 0;
    padding: 0 0 0 1rem;
    color: var(--md-color-text-muted);
    border-left: 4px solid var(--md-color-blockquote-border);
}

.markdown-body blockquote>*:first-child {
    margin-top: 0;
}

.markdown-body blockquote>*:last-child {
    margin-bottom: 0;
}

/* ========================================
   列表
   ======================================== */
.markdown-body ul,
.markdown-body ol {
    margin-top: 0;
    margin-bottom: 0;
    padding-left: 0;
    list-style-position: inside;
    white-space: normal;
}

.markdown-body ul {
    list-style-type: disc;
}

.markdown-body ol {
    list-style-type: decimal;
}

/* 嵌套列表缩进 */
.markdown-body li ul,
.markdown-body li ol {
    padding-left: 1.5rem;
}

/* 列表项 */
.markdown-body li {
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
}

/* 列表项内段落内联 */
.markdown-body li>p {
    display: inline;
}

/* ========================================
   表格
   ======================================== */
.markdown-body table {
    border-collapse: collapse;
    width: 100%;
    margin: 0;
    border: 1px solid var(--md-color-border);
    border-radius: var(--md-radius);
    overflow: hidden;
}

.markdown-body thead {
    background-color: var(--md-color-bg-table-header);
}

.markdown-body tbody {
    background-color: var(--md-color-bg-table-row);
}

.markdown-body tr {
    border-bottom: 1px solid var(--md-color-border);
}

.markdown-body tr:last-child {
    border-bottom: none;
}

.markdown-body th {
    padding: 0.5rem 1rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.875rem;
    white-space: nowrap;
    border: none;
}

.markdown-body td {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    border: none;
}

/* ========================================
   分割线
   ======================================== */
.markdown-body hr {
    border: 0;
    border-top: 1px solid var(--md-color-border);
    margin: 1.5rem 0;
}

/* ========================================
   图片
   ======================================== */
.markdown-body img {
    max-width: 100%;
    height: auto;
    border-radius: var(--md-radius);
}

/* ========================================
   删除线
   ======================================== */
.markdown-body del {
    color: var(--md-color-text-muted);
    text-decoration: line-through;
}

/* ========================================
   上标/下标
   ======================================== */
.markdown-body sup,
.markdown-body sub {
    font-size: 0.875rem;
}

/* ========================================
   代码高亮 (highlight.js)
   ======================================== */
.markdown-body .hljs {
    background: var(--md-hljs-bg);
    color: var(--md-hljs-text);
}

.markdown-body .hljs-keyword,
.markdown-body .hljs-selector-tag {
    color: var(--md-hljs-keyword);
}

.markdown-body .hljs-string,
.markdown-body .hljs-attr {
    color: var(--md-hljs-string);
}

.markdown-body .hljs-comment {
    color: var(--md-hljs-comment);
}

.markdown-body .hljs-function,
.markdown-body .hljs-title {
    color: var(--md-hljs-function);
}

.markdown-body .hljs-number {
    color: var(--md-hljs-number);
}

/* ========================================
   流式渲染 - Pending 状态
   ======================================== */
.markdown-body [data-pending="true"] {
    position: relative;
}

.markdown-body [data-pending="true"]::after {
    display: none;
}

.markdown-body pre[data-pending="true"]::after {
    display: none;
}

/* ========================================
   流式渲染 - 图片骨架屏
   ======================================== */
@keyframes md-image-shimmer {
    0% {
        background-position: 200% 0;
    }

    100% {
        background-position: -200% 0;
    }
}

.md-image-container {
    position: relative;
    display: block;
    border-radius: var(--md-radius);
    overflow: hidden;
}

.md-image {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.md-image-skeleton {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--md-skeleton-bg);
    background-image: linear-gradient(90deg, var(--md-skeleton-bg) 0%, var(--md-skeleton-shine) 50%, var(--md-skeleton-bg) 100%);
    background-size: 200% 100%;
    animation: md-image-shimmer 1.5s infinite;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--md-radius);
    z-index: 1;
    pointer-events: none;
}

.md-image-skeleton-icon {
    fill: var(--md-skeleton-icon);
}

.md-image-skeleton-icon-detail {
    fill: var(--md-skeleton-icon-detail);
}

/* ========================================
   流式渲染 - 文本淡入动画
   ======================================== */
@keyframes md-fade-in {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

.md-animation-text {
    color: inherit;
}